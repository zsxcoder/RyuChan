---
// src/components/widgets/MonthCalendar.astro
import Card from "../temple/Card.astro";
// è¿™é‡Œä¸å†è®¡ç®— todayï¼Œåªä¿ç•™éª¨æ¶
---

<Card>
  <div class="month-calendar p-4" id="month-calendar">
    <!-- å¤´éƒ¨ -->
    <div class="calendar-header mb-3">
      <h3 class="text-lg font-semibold flex items-center gap-2">
        <span class="text-xl">ğŸ“…</span>
        <span id="calendar-title">åŠ è½½ä¸­â€¦</span>
      </h3>
    </div>

    <!-- æ˜ŸæœŸæ ‡é¢˜ -->
    <div class="weekdays grid grid-cols-7 gap-1 mb-2">
      {
        ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"].map((d) => (
          <div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium">{d}</div>
        ))
      }
    </div>

    <!-- æ—¥æœŸæ ¼å­ -->
    <div class="calendar-grid grid grid-cols-7 gap-1" id="calendar-grid">
      <!-- JS ä¼šåœ¨è¿™é‡Œå¡«å…… -->
    </div>
  </div>
</Card>

<style lang="scss">
  /* ä½ çš„æ ·å¼ä¿æŒä¸å˜ */
</style>

<script>
  function renderCalendar() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    const date = today.getDate();
    const monthNames = [
      "ä¸€æœˆ",
      "äºŒæœˆ",
      "ä¸‰æœˆ",
      "å››æœˆ",
      "äº”æœˆ",
      "å…­æœˆ",
      "ä¸ƒæœˆ",
      "å…«æœˆ",
      "ä¹æœˆ",
      "åæœˆ",
      "åä¸€æœˆ",
      "åäºŒæœˆ",
    ];

    document.getElementById("calendar-title")!.textContent = `${year} å¹´ ${monthNames[month]}`;

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const cells: (number | null)[] = [
      ...Array.from({ length: firstDay }, () => null),
      ...Array.from({ length: daysInMonth }, (_, i) => i + 1),
    ];

    const grid = document.getElementById("calendar-grid")!;
    grid.innerHTML = "";
    cells.forEach((d) => {
      const div = document.createElement("div");
      div.className = "aspect-square flex items-center justify-center rounded text-sm relative";
      if (d === null) {
        div.classList.add("text-neutral-300", "dark:text-neutral-600");
      } else if (d === date) {
        div.classList.add("ring-2", "ring-[var(--c-primary)]", "font-bold");
      } else {
        div.classList.add("text-neutral-700", "dark:text-neutral-300");
      }
      div.textContent = d?.toString() ?? "";
      grid.appendChild(div);
    });

    // æ¯å¤© 0 ç‚¹è‡ªåŠ¨åˆ·æ–°
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);
    const ms = +tomorrow - Date.now();
    setTimeout(() => location.reload(), ms);
  }

  // ç¬¬ä¸€æ¬¡ç›´æ¥è·‘
  renderCalendar();

  // ä¹‹åæ¯æ¬¡è½¯å¯¼èˆªåå†è·‘
  document.addEventListener("astro:page-load", renderCalendar);
</script>
