---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import MainCard from "@/components/MainCard.astro";

/* ===============  构 建 时 拿 博 客 篇 数  =============== */
const token = import.meta.env.GH_TOKEN; // 支持 .env 或平台环境变量
const repo = "mcyzsx/RyuChan";
const folder = "src/content/blog";

async function getBlogCount(): Promise<number> {
  if (!token) return -1; // 未配置 Token 直接回退
  try {
    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${folder}`, {
      headers: { Authorization: `token ${token}` },
    });
    if (!res.ok) return -1;
    const list: any[] = await res.json();
    return list.filter((f) => /\.mdx?$/i.test(f.name)).length;
  } catch {
    return -1;
  }
}
const blogCount = await getBlogCount();
/* ========================================================= */

//出生
// 出生年份（只改这里）
const BIRTH_YEAR = 2005;
---

<BaseLayout title="关于我">
  <link rel="stylesheet" href="/css/netease-mini-player-v2.css" />
  <MainCard
    title="关于我"
    description="我的关于页面"
    textOverlay="ABOUT"
    image="/image/me-banner.webp"
    infoIcon="lucide:user"
  >
    <div class="space-y-10 mb-8">
      <!-- 页面头部 -->
      <section class="flex flex-col md:flex-row gap-8 items-center md:items-start">
        <div class="avatar">
          <div
            class="w-32 h-32 md:w-40 md:h-40 rounded-xl ring ring-primary ring-offset-base-100 ring-offset-2 overflow-hidden"
          >
            <img
              src="https://img-zsx.oss-cn-shanghai.aliyuncs.com/cb04a9a64f09bd4ba85d9908439653ed.jpg"
              alt="XZ"
              width="160"
              height="160"
              loading="eager"
              class="w-full h-full object-cover"
            />
          </div>
        </div>

        <div class="flex-1 text-center md:text-left">
          <h1 class="text-3xl md:text-4xl font-bold mb-2">钟神秀</h1>
          <p class="text-xl text-base-content/80 mb-4">造化钟神秀。阴阳割昏晓。</p>

          <!-- 联系方式 -->
          <!-- <div class="flex flex-wrap gap-3 justify-center md:justify-start mb-6">
            <a href="mailto:zwl2247103169@outlook.com" class="btn btn-sm btn-outline gap-2">
              <Icon name="lucide:mail" class="w-4 h-4" />
              <span>Email</span>
            </a>
            <a
              href="https://github.com/xz131714"
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-sm btn-outline gap-2"
            >
              <Icon name="lucide:github" class="w-4 h-4" />
              <span>GitHub</span>
            </a>
            <a
              href="https://twitter.com/xzz_ya"
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-sm btn-outline gap-2"
            >
              <Icon name="lucide:twitter" class="w-4 h-4" />
              <span>Twitter</span>
            </a>
          </div> -->

          <!-- 计数器 -->
          <p class="text-base-content/80">
            <img src="https://count.getloli.com/get/@:zsx815?theme=rule34&num=3149261770" alt="访问统计" />
            <h2>牛马普通人--钟神秀</h2>
            我在这个博客记录我的生活日常、踩坑记录和资源分享。
          </p>
        </div>
      </section>

      <!-- 信息卡片 -->
      <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- 出生/当前 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">信息</span>
          <div class="mt-8 space-y-4">
            <div class="flex items-center gap-x-4">
              <span class="text-sm text-base-content/70">出生</span>
              <span class="text-2xl font-bold">{BIRTH_YEAR}</span>
            </div>
            <div class="flex items-center gap-x-4">
              <span class="text-sm text-base-content/70">当前</span>
              <span class="text-2xl font-bold">
                {new Date().getFullYear() - BIRTH_YEAR}岁
              </span>
            </div>
          </div>
          <Icon name="ph:graduation-cap-bold" class="absolute left-4 bottom-4 w-16 h-16 text-base-content/10" />
          <Icon name="ph:calendar-dots-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 座右铭 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">座右铭</span>
          <div class="mt-8">
            <p class="text-2xl font-bold">每一段旅程，</p>
            <p class="text-2xl font-bold">都有终点。</p>
          </div>
          <Icon name="ph:compass-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 关注偏好 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">关注偏好</span>
          <div class="mt-8">
            <h3 class="text-2xl font-bold mb-1">资源分享</h3>
            <p class="text-sm text-base-content/70">小说、单机游戏</p>
          </div>
          <Icon name="ph:star-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 音乐偏好 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">音乐偏好</span>
          <div class="mt-8">
            <h3 class="text-2xl font-bold mb-1">国风、古风等</h3>
            <p class="text-sm text-base-content/70">我喜欢就听</p>
          </div>
          <Icon name="ph:music-notes-simple-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 性格 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">性格</span>
          <div class="mt-8 text-center">
            <p class="text-2xl font-bold">提倡者</p>
            <p class="text-lg text-base-content/80">INFJ-T</p>
            <a
              href="https://www.16personalities.com"
              target="_blank"
              rel="noopener noreferrer"
              class="text-xs link link-primary absolute right-4 bottom-4"
            >
              在 16 Personalities 了解更多
            </a>
          </div>
          <Icon name="ph:brain-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 特长 -->
        <div class="card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">特长</span>
          <div class="mt-8 text-center text-xl font-bold">
            <p>活到老，学到老</p>
            <p class="mt-2">
              学习能力 <span class="text-primary text-3xl">MAX</span>
            </p>
          </div>
          <Icon name="ph:magic-wand-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 联系方式 -->
        <div class="sm:col-span-2 lg:col-span-3 card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">联系我</span>
          <div class="mt-8 flex flex-wrap justify-center gap-4">
            {
              [
                { icon: "ph:envelope-simple-bold", url: "mailto:mcyzsx815@qq.com", tip: "邮箱" },
                // { icon: "ph:wechat-logo-bold", url: "https://weixin.qq.com", tip: "微信" },
                { icon: "ri:bilibili-fill", url: "https://bilibili.com", tip: "哔哩哔哩" },
                { icon: "ph:telegram-logo-bold", url: "https://t.me/zhzsx_me", tip: "Telegram" },
                // { icon: "ph:discord-logo-bold", url: "https://discord.com", tip: "Discord" },
                { icon: "ph:x-logo-bold", url: "https://x.com/kemiao", tip: "X" },
                { icon: "ph:github-logo-bold", url: "https://github.com/mcyzsx", tip: "GitHub" },
              ].map((l) => (
                <a
                  href={l.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="btn btn-circle btn-outline"
                  aria-label={l.tip}
                >
                  <Icon name={l.icon} class="w-5 h-5" />
                </a>
              ))
            }
          </div>
          <Icon name="ph:address-book-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 正在听 -->
        <div class="sm:col-span-2 lg:col-span-3 card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">正在听</span>

          <!-- 播放器容器 -->
          <div class="mt-8 flex justify-center">
            <div
              id="nmp"
              class="netease-mini-player"
              data-playlist-id="13681647281"
              data-lyric="true"
              data-theme="auto"
              data-size="compact"
            >
            </div>
          </div>

          <Icon name="ph:music-notes-simple-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>

        <!-- 网站统计 -->
        <div class="sm:col-span-2 lg:col-span-3 card card-bordered p-6 relative">
          <span class="absolute top-4 left-6 text-xs text-base-content/60">网站统计</span>

          <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div class="stat-item">
              <div id="pv-today" class="text-2xl font-bold">--</div>
              <div class="text-xs text-base-content/70">今日 PV</div>
            </div>
            <div class="stat-item">
              <div id="uv-today" class="text-2xl font-bold">--</div>
              <div class="text-xs text-base-content/70">今日 UV</div>
            </div>
            <div class="stat-item">
              <div id="visit-today" class="text-2xl font-bold">--</div>
              <div class="text-xs text-base-content/70">今日 Visit</div>
            </div>
            <!-- 博客篇数：构建时直出 -->
            <div class="stat-item">
              <div class="text-2xl font-bold">
                {blogCount >= 0 ? blogCount : "∞"}
              </div>
              <div class="text-xs text-base-content/70">篇博客</div>
            </div>
          </div>

          <Icon name="ph:chart-line-bold" class="absolute right-4 bottom-4 w-16 h-16 text-base-content/10" />
        </div>
      </section>
    </div>
  </MainCard>
</BaseLayout>

<script is:inline src="/js/netease-mini-player-v2.js"></script>

<!-- 浏览器端仅保留 PV/UV/Visit 统计 -->
<script>
  (async () => {
    const worker = "https://han-ryu.zsx815.top/?site=ryu&time=today";
    try {
      const res = await fetch(worker);
      const { views, visitor, visit } = await res.json();
      const set = (sel: string, val: { toLocaleString: () => any }) => {
        const el = document.querySelector(sel);
        if (el) el.textContent = val.toLocaleString();
      };
      set("#pv-today", views);
      set("#uv-today", visitor);
      set("#visit-today", visit);
    } catch {}
  })();

  // 如果播放器把初始化函数挂在全局，直接调用
  function initNMP() {
    const w = window as any;
    if (typeof w.NeteaseMiniPlayer !== "undefined") {
      w.NeteaseMiniPlayer.init(); // 常见 API 名称
    } else if (typeof w.initNMP === "function") {
      w.initNMP(); // 个别版本
    } else {
      // 有的版本会自动扫描 DOM，什么都不用做
      console.log("[NMP] 未发现显式初始化函数，已交由插件自动扫描");
    }
  }

  // 保险：DOM 就绪 + 脚本加载完成
  function ready() {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initNMP);
    } else {
      initNMP();
    }
  }
  ready();
</script>
